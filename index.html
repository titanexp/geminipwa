            applySettingsToUI() {
                this.toggleApiSettingsVisibility(state.settings.apiProvider);
                elements.apiProviderSelect.value = state.settings.apiProvider;
                twinEngineApiConfigUtils.renderList();
                elements.commonSystemPromptDefaultTextarea.value = state.settings.commonSystemPrompt || '';
                elements.enableCommonSystemPromptDefaultCheckbox.checked = state.settings.enableCommonSystemPromptDefault;
                elements.twinEngineEnableFullAutoToggle.checked = state.settings.twinEngineEnableFullAuto;
                elements.showFooterTwinEngineToggleButtonToggle.checked = state.settings.showFooterTwinEngineToggleButton;
                elements.showFooterResummarizeButtonToggle.checked = state.settings.showFooterResummarizeButton;
                elements.twinEngineFullAutoSettingContainer.classList.toggle('hidden', !state.settings.showTwinEngineSettings);
                elements.twinEngineSummarizeAfterTurnsInput.value = state.settings.twinEngineSummarizeAfterTurns ?? DEFAULT_TWIN_ENGINE_SUMMARIZE_AFTER_TURNS;
                document.getElementById('twin-engine-initial-turns-to-include').value = state.settings.twinEngineInitialTurnsToInclude ?? 1;
                elements.twinEngineSummaryPromptInput.value = state.settings.twinEngineSummaryPrompt || '';
                elements.twinEngineDummyUserInput.value = state.settings.twinEngineDummyUser || '';
                elements.twinEngineEnableDummyUserCheckbox.checked = state.settings.twinEngineEnableDummyUser;
                elements.twinEngineDummyModelInput.value = state.settings.twinEngineDummyModel || '';
                elements.twinEngineEnableDummyModelCheckbox.checked = state.settings.twinEngineEnableDummyModel;
                elements.twinEngineConcatDummyModelCheckbox.checked = state.settings.twinEngineConcatDummyModel;

                elements.geminiApiKeyInput.value = state.settings.apiKey || '';
                elements.geminiModelNameSelect.value = state.settings.modelName || DEFAULT_MODEL;
                elements.geminiAdditionalModelsTextarea.value = state.settings.additionalModels || '';
                elements.deepSeekApiKeyInput.value = state.settings.deepSeekApiKey || '';
                elements.deepSeekModelNameSelect.value = state.settings.deepSeekModelName || DEFAULT_DEEPSEEK_MODEL;
                elements.deepSeekAdditionalModelsTextarea.value = state.settings.deepSeekAdditionalModels || '';
                elements.deepSeekApiEndpointInput.value = state.settings.deepSeekApiEndpoint || '';
                elements.claudeApiKeyInput.value = state.settings.claudeApiKey || '';
                elements.claudeModelNameSelect.value = state.settings.claudeModelName || DEFAULT_CLAUDE_MODEL;
                elements.claudeAdditionalModelsTextarea.value = state.settings.claudeAdditionalModels || '';
                elements.openaiApiKeyInput.value = state.settings.openaiApiKey || '';
                elements.openaiModelNameSelect.value = state.settings.openaiModelName || DEFAULT_OPENAI_MODEL;
                elements.openaiAdditionalModelsTextarea.value = state.settings.openaiAdditionalModels || '';
                elements.xaiApiKeyInput.value = state.settings.xaiApiKey || '';
                elements.xaiModelNameSelect.value = state.settings.xaiModelName || DEFAULT_XAI_MODEL;
                elements.xaiAdditionalModelsTextarea.value = state.settings.xaiAdditionalModels || '';
                elements.llmAggregatorApiBackendInput.value = state.settings.llmAggregatorApiBackend || '';
                elements.llmAggregatorApiKeyInput.value = state.settings.llmAggregatorApiKey || '';
                elements.llmAggregatorModelNameSelect.value = state.settings.llmAggregatorModelName || DEFAULT_LLMAGGREGATOR_MODEL;
                elements.llmAggregatorAdditionalModelsTextarea.value = state.settings.llmAggregatorAdditionalModels || '';
                
                multiApiKeyUtils.renderAllApiKeyLists();
                multiApiKeyUtils.updateMainApiKeyInput('gemini');
                multiApiKeyUtils.updateMainApiKeyInput('deepseek');
                multiApiKeyUtils.updateMainApiKeyInput('claude');
                multiApiKeyUtils.updateMainApiKeyInput('openai');
                multiApiKeyUtils.updateMainApiKeyInput('xai');
                multiApiKeyUtils.updateMainApiKeyInput('llmaggregator');

                elements.geminiSystemPromptDefaultTextarea.value = state.settings.geminiSystemPrompt || '';
                elements.geminiEnableSystemPromptDefaultCheckbox.checked = state.settings.geminiEnableSystemPromptDefault;
                elements.geminiTemperatureInput.value = state.settings.geminiTemperature === null ? '' : state.settings.geminiTemperature;
                elements.geminiMaxTokensInput.value = state.settings.geminiMaxTokens === null ? '' : state.settings.geminiMaxTokens;
                elements.geminiTopKInput.value = state.settings.geminiTopK === null ? '' : state.settings.geminiTopK;
                elements.geminiTopPInput.value = state.settings.geminiTopP === null ? '' : state.settings.geminiTopP;
                elements.geminiPresencePenaltyInput.value = state.settings.geminiPresencePenalty === null ? '' : state.settings.geminiPresencePenalty;
                elements.geminiFrequencyPenaltyInput.value = state.settings.geminiFrequencyPenalty === null ? '' : state.settings.geminiFrequencyPenalty;
                elements.geminiThinkingBudgetInput.value = state.settings.geminiThinkingBudget === null ? '' : state.settings.geminiThinkingBudget;
                elements.geminiIncludeThoughtsToggle.checked = state.settings.geminiIncludeThoughts;
                elements.geminiExpandThoughtsByDefaultToggle.checked = state.settings.geminiExpandThoughtsByDefault;
                elements.geminiStreamingOutputCheckbox.checked = state.settings.geminiStreamingOutput;
                elements.geminiStreamingSpeedInput.value = state.settings.geminiStreamingSpeed ?? DEFAULT_STREAMING_SPEED;
                elements.geminiDummyUserInput.value = state.settings.geminiDummyUser || '';
                elements.geminiEnableDummyUserCheckbox.checked = state.settings.geminiEnableDummyUser;
                elements.geminiDummyModelInput.value = state.settings.geminiDummyModel || '';
                elements.geminiEnableDummyModelCheckbox.checked = state.settings.geminiEnableDummyModel;
                elements.geminiConcatDummyModelCheckbox.checked = state.settings.geminiConcatDummyModel;
                elements.geminiPseudoStreamingCheckbox.checked = state.settings.geminiPseudoStreaming;
                elements.geminiEnableGroundingToggle.checked = state.settings.geminiEnableGrounding;

                elements.deepSeekSystemPromptDefaultTextarea.value = state.settings.deepSeekSystemPrompt || '';
                elements.deepSeekEnableSystemPromptDefaultCheckbox.checked = state.settings.deepSeekEnableSystemPromptDefault;
                elements.deepSeekTemperatureInput.value = state.settings.deepSeekTemperature === null ? '' : state.settings.deepSeekTemperature;
                elements.deepSeekMaxTokensInput.value = state.settings.deepSeekMaxTokens === null ? '' : state.settings.deepSeekMaxTokens;
                elements.deepSeekTopPInput.value = state.settings.deepSeekTopP === null ? '' : state.settings.deepSeekTopP;
                elements.deepSeekPresencePenaltyInput.value = state.settings.deepSeekPresencePenalty === null ? '' : state.settings.deepSeekPresencePenalty;
                elements.deepSeekFrequencyPenaltyInput.value = state.settings.deepSeekFrequencyPenalty === null ? '' : state.settings.deepSeekFrequencyPenalty;
                elements.deepSeekIncludeThoughtsToggle.checked = state.settings.deepSeekIncludeDeepSeekThoughts;
                elements.deepSeekExpandThoughtsByDefaultToggle.checked = state.settings.deepSeekExpandThoughtsByDefault;
                elements.deepSeekStreamingOutputCheckbox.checked = state.settings.deepSeekStreamingOutput;
                elements.deepSeekStreamingSpeedInput.value = state.settings.deepSeekStreamingSpeed ?? DEFAULT_STREAMING_SPEED;
                elements.deepSeekDummyUserInput.value = state.settings.deepSeekDummyUser || '';
                elements.deepSeekEnableDummyUserCheckbox.checked = state.settings.deepSeekEnableDummyUser;
                elements.deepSeekDummyModelInput.value = state.settings.deepSeekDummyModel || '';
                elements.deepSeekEnableDummyModelCheckbox.checked = state.settings.deepSeekEnableDummyModel;
                elements.deepSeekConcatDummyModelCheckbox.checked = state.settings.deepSeekConcatDummyModel;

                elements.claudeSystemPromptDefaultTextarea.value = state.settings.claudeSystemPrompt || '';
                elements.claudeEnableSystemPromptDefaultCheckbox.checked = state.settings.claudeEnableSystemPromptDefault;
                elements.claudeTemperatureInput.value = state.settings.claudeTemperature === null ? '' : state.settings.claudeTemperature;
                elements.claudeMaxTokensInput.value = state.settings.claudeMaxTokens === null ? '' : state.settings.claudeMaxTokens;
                elements.claudeTopKInput.value = state.settings.claudeTopK === null ? '' : state.settings.claudeTopK;
                elements.claudeTopPInput.value = state.settings.claudeTopP === null ? '' : state.settings.claudeTopP;
                elements.claudeStreamingOutputCheckbox.checked = state.settings.claudeStreamingOutput;
                elements.claudeStreamingSpeedInput.value = state.settings.claudeStreamingSpeed ?? DEFAULT_STREAMING_SPEED;
                elements.claudeDummyUserInput.value = state.settings.claudeDummyUser || '';
                elements.claudeEnableDummyUserCheckbox.checked = state.settings.claudeEnableDummyUser;
                elements.claudeDummyModelInput.value = state.settings.claudeDummyModel || '';
                elements.claudeEnableDummyModelCheckbox.checked = state.settings.claudeEnableDummyModel;
                elements.claudeConcatDummyModelCheckbox.checked = state.settings.claudeConcatDummyModel;
                elements.claudeIncludeThoughtsToggle.checked = state.settings.claudeIncludeThoughts;
                elements.claudeExpandThoughtsByDefaultToggle.checked = state.settings.claudeExpandThoughtsByDefault;
                elements.claudeThinkingBudgetInput.value = state.settings.claudeThinkingBudget === null ? '' : state.settings.claudeThinkingBudget;

                elements.openaiSystemPromptDefaultTextarea.value = state.settings.openaiSystemPrompt || '';
                elements.openaiEnableSystemPromptDefaultCheckbox.checked = state.settings.openaiEnableSystemPromptDefault;
                elements.openaiTemperatureInput.value = state.settings.openaiTemperature === null ? '' : state.settings.openaiTemperature;
                elements.openaiMaxTokensInput.value = state.settings.openaiMaxTokens === null ? '' : state.settings.openaiMaxTokens;
                elements.openaiTopPInput.value = state.settings.openaiTopP === null ? '' : state.settings.openaiTopP;
                elements.openaiPresencePenaltyInput.value = state.settings.openaiPresencePenalty === null ? '' : state.settings.openaiPresencePenalty;
                elements.openaiFrequencyPenaltyInput.value = state.settings.openaiFrequencyPenalty === null ? '' : state.settings.openaiFrequencyPenalty;
                elements.openaiStreamingOutputCheckbox.checked = state.settings.openaiStreamingOutput;
                elements.openaiStreamingSpeedInput.value = state.settings.openaiStreamingSpeed ?? DEFAULT_STREAMING_SPEED;
                elements.openaiDummyUserInput.value = state.settings.openaiDummyUser || '';
                elements.openaiEnableDummyUserCheckbox.checked = state.settings.openaiEnableDummyUser;
                elements.openaiDummyModelInput.value = state.settings.openaiDummyModel || '';
                elements.openaiEnableDummyModelCheckbox.checked = state.settings.openaiEnableDummyModel;
                elements.openaiConcatDummyModelCheckbox.checked = state.settings.openaiConcatDummyModel;
                
                elements.xaiSystemPromptDefaultTextarea.value = state.settings.xaiSystemPrompt || '';
                elements.xaiEnableSystemPromptDefaultCheckbox.checked = state.settings.xaiEnableSystemPromptDefault;
                elements.xaiTemperatureInput.value = state.settings.xaiTemperature === null ? '' : state.settings.xaiTemperature;
                elements.xaiMaxTokensInput.value = state.settings.xaiMaxTokens === null ? '' : state.settings.xaiMaxTokens;
                elements.xaiTopPInput.value = state.settings.xaiTopP === null ? '' : state.settings.xaiTopP;
                elements.xaiPresencePenaltyInput.value = state.settings.xaiPresencePenalty === null ? '' : state.settings.xaiPresencePenalty;
                elements.xaiFrequencyPenaltyInput.value = state.settings.xaiFrequencyPenalty === null ? '' : state.settings.xaiFrequencyPenalty;
                elements.xaiStreamingOutputCheckbox.checked = state.settings.xaiStreamingOutput;
                elements.xaiStreamingSpeedInput.value = state.settings.xaiStreamingSpeed ?? DEFAULT_STREAMING_SPEED;
                elements.xaiDummyUserInput.value = state.settings.xaiDummyUser || '';
                elements.xaiEnableDummyUserCheckbox.checked = state.settings.xaiEnableDummyUser;
                elements.xaiDummyModelInput.value = state.settings.xaiDummyModel || '';
                elements.xaiEnableDummyModelCheckbox.checked = state.settings.xaiEnableDummyModel;
                elements.xaiConcatDummyModelCheckbox.checked = state.settings.xaiConcatDummyModel;
                elements.xaiVisionEnableCheckbox.checked = state.settings.xaiVisionEnable;
                elements.xaiIncludeThoughtsToggle.checked = state.settings.xaiIncludeThoughts;
                elements.xaiExpandThoughtsByDefaultToggle.checked = state.settings.xaiExpandThoughtsByDefault;
                elements.xaiReasoningEffortSelect.value = state.settings.xaiReasoningEffort;
                
                elements.llmAggregatorSystemPromptDefaultTextarea.value = state.settings.llmAggregatorSystemPrompt || '';
                elements.llmAggregatorEnableSystemPromptDefaultCheckbox.checked = state.settings.llmAggregatorEnableSystemPromptDefault;
                elements.llmAggregatorTemperatureInput.value = state.settings.llmAggregatorTemperature === null ? '' : state.settings.llmAggregatorTemperature;
                elements.llmAggregatorMaxTokensInput.value = state.settings.llmAggregatorMaxTokens === null ? '' : state.settings.llmAggregatorMaxTokens;
                elements.llmAggregatorTopPInput.value = state.settings.llmAggregatorTopP === null ? '' : state.settings.llmAggregatorTopP;
                elements.llmAggregatorTopKInput.value = state.settings.llmAggregatorTopK === null ? '' : state.settings.llmAggregatorTopK;
                elements.llmAggregatorPresencePenaltyInput.value = state.settings.llmAggregatorPresencePenalty === null ? '' : state.settings.llmAggregatorPresencePenalty;
                elements.llmAggregatorFrequencyPenaltyInput.value = state.settings.llmAggregatorFrequencyPenalty === null ? '' : state.settings.llmAggregatorFrequencyPenalty;
                elements.llmAggregatorIncludeThoughtsToggle.checked = state.settings.llmAggregatorIncludeThoughts;
                elements.llmAggregatorExpandThoughtsByDefaultToggle.checked = state.settings.llmAggregatorExpandThoughtsByDefault;
                elements.llmAggregatorStreamingOutputCheckbox.checked = state.settings.llmAggregatorStreamingOutput;
                elements.llmAggregatorStreamingSpeedInput.value = state.settings.llmAggregatorStreamingSpeed ?? DEFAULT_STREAMING_SPEED;
                elements.llmAggregatorDummyUserInput.value = state.settings.llmAggregatorDummyUser || '';
                elements.llmAggregatorEnableDummyUserCheckbox.checked = state.settings.llmAggregatorEnableDummyUser;
                elements.llmAggregatorDummyModelInput.value = state.settings.llmAggregatorDummyModel || '';
                elements.llmAggregatorEnableDummyModelCheckbox.checked = state.settings.llmAggregatorEnableDummyModel;
                elements.llmAggregatorConcatDummyModelCheckbox.checked = state.settings.llmAggregatorConcatDummyModel;

                 elements.enterToSendCheckbox.checked = state.settings.enterToSend;
                 elements.autoScrollOnNewMessageCheckbox.checked = state.settings.autoScrollOnNewMessage;
                 elements.autoScrollOnThoughtCheckbox.checked = state.settings.autoScrollOnThought;
                 elements.historySortOrderSelect.value = state.settings.historySortOrder || 'updatedAt';
                 if (elements.themeSelect) elements.themeSelect.value = state.settings.theme || 'light';
                 elements.enableSessionLinkingCheckbox.checked = state.settings.enableSessionLinking;
                 elements.fontFamilyInput.value = state.settings.fontFamily || '';
                 elements.messageBodyFontSizeInput.value = state.settings.messageBodyFontSize ?? '';
                 elements.codeBlockFontSizeInput.value = state.settings.codeBlockFontSize ?? '';
                 elements.thoughtSummaryFontSizeInput.value = state.settings.thoughtSummaryFontSize ?? '';
                 elements.swipeNavigationToggle.checked = state.settings.enableSwipeNavigation;
                 elements.preventZoomToggle.checked = state.settings.preventZoom;
                 elements.minimizeHeaderFooterToggle.checked = state.settings.minimizeHeaderFooter;
                 elements.extendAiBubbleWidthToggle.checked = state.settings.extendAiBubbleWidth;
                 elements.showSessionLinkingSettingsToggle.checked = state.settings.showSessionLinkingSettings;
                 if (elements.sessionLinkingSettingsGroup) {
                     elements.sessionLinkingSettingsGroup.classList.toggle('hidden', !state.settings.showSessionLinkingSettings);
                 }
                elements.showTwinEngineSettingsToggle.checked = state.settings.showTwinEngineSettings;
                const twinEngineSettingsGroup = document.getElementById('settings-group-twin-engine');
                if (twinEngineSettingsGroup) {
                    twinEngineSettingsGroup.classList.toggle('hidden', !state.settings.showTwinEngineSettings);
                }
                 elements.showChatTitleToggle.checked = state.settings.showChatTitle;
                 elements.showNewChatButtonToggle.checked = state.settings.showNewChatButton;
                 elements.showDeleteSessionButtonToggle.checked = state.settings.showDeleteSessionButton;
                 elements.showCopySessionButtonToggle.checked = state.settings.showCopySessionButton;
                 elements.showScrollToTopButtonToggle.checked = state.settings.showScrollToTopButton;
                 elements.showScrollToBottomButtonToggle.checked = state.settings.showScrollToBottomButton;
                 elements.showToggleAllContentButtonToggle.checked = state.settings.showToggleAllContentButton;
                 elements.showBulkHistoryActionsToggle.checked = state.settings.showBulkHistoryActions;
                 elements.showPasteButtonInFooterToggle.checked = state.settings.showPasteButtonInFooter;
                 elements.showPasteButtonInEditToggle.checked = state.settings.showPasteButtonInEdit;
                 elements.showDiceButtonToggle.checked = state.settings.showDiceButton;
                 document.getElementById('dice-value-settings').classList.toggle('hidden', !state.settings.showDiceButton);
                 elements.diceMinValueInput.value = state.settings.diceMinValue ?? '';
                 elements.diceMaxValueInput.value = state.settings.diceMaxValue ?? '';
                 elements.messageBubbleOpacityInput.value = state.settings.messageBubbleOpacity ?? DEFAULT_MESSAGE_BUBBLE_OPACITY;
                 elements.chatOverlayOpacityInput.value = state.settings.chatOverlayOpacity ?? DEFAULT_CHAT_OVERLAY_OPACITY;
                 elements.headerFooterOpacityInput.value = state.settings.headerFooterOpacity ?? DEFAULT_HEADER_FOOTER_OPACITY;
                 elements.messageActionsBackgroundOpacityInput.value = state.settings.messageActionsBackgroundOpacity ?? DEFAULT_MESSAGE_ACTIONS_BACKGROUND_OPACITY;
                 elements.thoughtSummaryOpacityInput.value = state.settings.thoughtSummaryOpacity ?? DEFAULT_THOUGHT_SUMMARY_OPACITY;
                 elements.showApiProviderToggleHeaderCheckbox.checked = state.settings.showApiProviderToggleHeader;
                 elements.showApiProviderToggleFooterCheckbox.checked = state.settings.showApiProviderToggleFooter;
                 elements.apiProviderCycleGeminiCheckbox.checked = state.settings.apiProviderCycle.gemini;
                 elements.apiProviderCycleDeepSeekCheckbox.checked = state.settings.apiProviderCycle.deepseek;
                 elements.apiProviderCycleClaudeCheckbox.checked = state.settings.apiProviderCycle.claude;
                 elements.apiProviderCycleOpenAICheckbox.checked = state.settings.apiProviderCycle.openai;
                 elements.apiProviderCycleXaiCheckbox.checked = state.settings.apiProviderCycle.xai;
                 elements.apiProviderCycleLlmAggregatorCheckbox.checked = state.settings.apiProviderCycle.llmaggregator;
                 elements.apiProviderCycleDummyCheckbox.checked = state.settings.apiProviderCycle.dummy;
                 elements.dummyDummyModelInput.value = state.settings.dummyDummyModel || '';
                 elements.dummyEnableDummyModelCheckbox.checked = state.settings.dummyEnableDummyModel;
                 elements.dummyTwinEngineDebugModeCheckbox.checked = state.settings.dummyTwinEngineDebugMode;

                elements.showMemoButtonToggle.checked = state.settings.showMemoButton;
                elements.showTwinEngineSummaryButtonToggle.checked = state.settings.showTwinEngineSummaryButton;
                elements.memoHeightInput.value = state.settings.memoHeight || '';
                elements.showClipboardStackButtonToggle.checked = state.settings.showClipboardStackButton;
                elements.showUserIconToggle.checked = state.settings.showUserIcon;
                elements.showUserNameToggle.checked = state.settings.showUserName;
                elements.userNameInput.value = state.settings.userName || '';
                 elements.showAiIconToggle.checked = state.settings.showAiIcon;
                 elements.showAiNameToggle.checked = state.settings.showAiName;
                elements.aiNameInput.value = state.settings.aiName || '';
                elements.iconNameFontSizeInput.value = state.settings.iconNameFontSize ?? DEFAULT_ICON_NAME_FONT_SIZE;
                elements.iconNameOffsetYInput.value = state.settings.iconNameOffsetY !== null ? (state.settings.iconNameOffsetY * -1) : (DEFAULT_ICON_NAME_OFFSET_Y * -1);
                elements.messageIconSizeInput.value = state.settings.messageIconSize ?? DEFAULT_MESSAGE_ICON_SIZE;
                elements.messageIconOffsetYInput.value = state.settings.messageIconOffsetY !== null ? (state.settings.messageIconOffsetY * -1) : (DEFAULT_MESSAGE_ICON_OFFSET_Y * -1);

                elements.userNameBubbleToggle.checked = state.settings.showUserNameBubble;
                elements.userNameBubbleUseThemeColorToggle.checked = state.settings.userNameBubbleUseThemeColor;
                elements.userNameBubbleColorInput.value = state.settings.userNameBubbleColor || DEFAULT_USER_NAME_BUBBLE_COLOR;
                elements.userNameBubbleOpacityInput.value = state.settings.userNameBubbleOpacity ?? DEFAULT_USER_NAME_BUBBLE_OPACITY;
                elements.aiNameBubbleToggle.checked = state.settings.showAiNameBubble;
                elements.aiNameBubbleUseThemeColorToggle.checked = state.settings.aiNameBubbleUseThemeColor;
                elements.aiNameBubbleColorInput.value = state.settings.aiNameBubbleColor || DEFAULT_AI_NAME_BUBBLE_COLOR;
                elements.aiNameBubbleOpacityInput.value = state.settings.aiNameBubbleOpacity ?? DEFAULT_AI_NAME_BUBBLE_OPACITY;

                elements.disableRetryConfirmationToggle.checked = state.settings.disableRetryConfirmation;
                elements.disableLoadChatConfirmationWhileSendingToggle.checked = state.settings.disableLoadChatConfirmationWhileSending;
                elements.disableDeleteMessageConfirmationToggle.checked = state.settings.disableDeleteMessageConfirmation;
                elements.disableAttachmentConfirmationToggle.checked = state.settings.disableAttachmentConfirmation;
                elements.addPrefixOnImportToggle.checked = state.settings.addPrefixOnImport;
                elements.showMultiApiKeysToggle.checked = state.settings.showMultiApiKeys;
                elements.disableSaveSettingsConfirmationToggle.checked = state.settings.disableSaveSettingsConfirmation;
                elements.autoSaveSettingsToggle.checked = state.settings.autoSaveSettings;
                elements.showTopCollapseButtonToggle.checked = state.settings.showTopCollapseButton;
                elements.showBottomCollapseButtonToggle.checked = state.settings.showBottomCollapseButton;
                elements.persistMessageCollapseStateCheckbox.checked = state.settings.persistMessageCollapseState;

                elements.toggleButtonTopWidthInput.value = state.settings.toggleButtonTopWidth ?? DEFAULT_TOGGLE_BUTTON_TOP_WIDTH;
                elements.toggleButtonTopHeightInput.value = state.settings.toggleButtonTopHeight ?? DEFAULT_TOGGLE_BUTTON_TOP_HEIGHT;
                elements.toggleButtonTopFontSizeInput.value = state.settings.toggleButtonTopFontSize ?? DEFAULT_TOGGLE_BUTTON_TOP_FONT_SIZE;
                elements.toggleButtonTopOpacityInput.value = state.settings.toggleButtonTopOpacity ?? DEFAULT_TOGGLE_BUTTON_TOP_OPACITY;
                elements.toggleButtonTopTextCollapseInput.value = state.settings.toggleButtonTopTextCollapse || DEFAULT_TOGGLE_BUTTON_TOP_TEXT_COLLAPSE;
                elements.toggleButtonTopTextExpandInput.value = state.settings.toggleButtonTopTextExpand || DEFAULT_TOGGLE_BUTTON_TOP_TEXT_EXPAND;
                elements.toggleButtonBottomFontSizeInput.value = state.settings.toggleButtonBottomFontSize ?? DEFAULT_TOGGLE_BUTTON_BOTTOM_FONT_SIZE;
                elements.toggleButtonBottomTextCollapseInput.value = state.settings.toggleButtonBottomTextCollapse || DEFAULT_TOGGLE_BUTTON_BOTTOM_TEXT_COLLAPSE;
                elements.toggleButtonBottomTextExpandInput.value = state.settings.toggleButtonBottomTextExpand || DEFAULT_TOGGLE_BUTTON_BOTTOM_TEXT_EXPAND;
                elements.thoughtSummaryOpacityInput.value = state.settings.thoughtSummaryOpacity ?? DEFAULT_THOUGHT_SUMMARY_OPACITY;
                elements.dummyErrorDebugModeCheckbox.checked = state.settings.dummyErrorDebugMode;

                document.documentElement.style.setProperty('--message-body-font-size', `${state.settings.messageBodyFontSize || DEFAULT_MESSAGE_BODY_FONT_SIZE}px`);
                document.documentElement.style.setProperty('--code-block-font-size', `${state.settings.codeBlockFontSize || DEFAULT_CODE_BLOCK_FONT_SIZE}px`);
                document.documentElement.style.setProperty('--thought-summary-font-size', `${state.settings.thoughtSummaryFontSize || DEFAULT_THOUGHT_SUMMARY_FONT_SIZE}px`);
                document.documentElement.style.setProperty('--message-toggle-button-top-width', `${state.settings.toggleButtonTopWidth || DEFAULT_TOGGLE_BUTTON_TOP_WIDTH}px`);
                document.documentElement.style.setProperty('--message-toggle-button-top-height', `${state.settings.toggleButtonTopHeight || DEFAULT_TOGGLE_BUTTON_TOP_HEIGHT}px`);
                document.documentElement.style.setProperty('--message-toggle-button-top-font-size', `${state.settings.toggleButtonTopFontSize || DEFAULT_TOGGLE_BUTTON_TOP_FONT_SIZE}px`);
                document.documentElement.style.setProperty('--message-toggle-button-top-opacity', state.settings.toggleButtonTopOpacity);
                document.documentElement.style.setProperty('--message-toggle-button-bottom-font-size', `${state.settings.toggleButtonBottomFontSize || DEFAULT_TOGGLE_BUTTON_BOTTOM_FONT_SIZE}px`);
                document.documentElement.style.setProperty('--thought-summary-opacity', state.settings.thoughtSummaryOpacity || DEFAULT_THOUGHT_SUMMARY_OPACITY);

                this.applySettingsUIDetailsOpenStates();
                this.updateChatScreenElementVisibility();
                this.updateHistoryHeaderButtonVisibility();
                this.updateUserModelOptions();
                this.updateDeepSeekUserModelOptions();
                this.updateClaudeUserModelOptions();
                this.updateOpenAIUserModelOptions();
                this.updateXaiUserModelOptions();
                this.updateLlmAggregatorUserModelOptions();
                this.updateBackgroundSettingsUI();
                this.updateIconSettingsUI();
                this.applyTheme();
                this.applyFontFamily();
                this.applySidePanelSettingsToUI();
                this.applyMinimizeUI();
                this.applyAiBubbleWidthSetting();
                this.updateSessionLinkingUI();
                this.updateApiProviderSelectOptions();
                this.toggleMultiApiKeysVisibility(state.settings.showMultiApiKeys);
                elements.settingsScreen.classList.toggle('auto-save-mode', state.settings.autoSaveSettings);
                this.updateMemoStackHeightSettingsVisibility();
                this.updateTwinEngineModeButton();
                this.updateTwinEngineApiKeyCycleButton();
            },
